# Tech Insights - Backend Service

## í”„ë¡œì íŠ¸ ê°œìš”

Tech InsightsëŠ” ìµœì‹  IT ê¸°ìˆ  ê´€ë ¨ íšŒì‚¬ë“¤ì˜ ê¸°ìˆ  ë¸”ë¡œê·¸ ê²Œì‹œê¸€ì„ ëª¨ì•„ ë³´ì—¬ì£¼ëŠ” í”Œë«í¼ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë‹¤ì–‘í•œ ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ê¸€ê³¼ ì¸ê¸° ê¸€ì„ íƒìƒ‰í•  ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ë³„ ë¸”ë¡œê·¸ ìš”ì•½, ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°, ëŒ“ê¸€ ì‘ì„±, ì¢‹ì•„ìš” ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

- ê¸°ì—…ë³„ ê¸°ìˆ ë¸”ë¡œê·¸ í”¼ë“œ
  - ê° ê¸°ì—…ì˜ ìµœì‹  ê¸°ìˆ  ì•„í‹°í´ì„ ìˆ˜ì§‘í•˜ì—¬ ìš”ì•½ ë° ì›ë¬¸ ë§í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
  - ì¡°íšŒìˆ˜, ê²Œì‹œë¬¼ ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì£¼ëª©ë°›ëŠ” ê¸°ì—… ë­í‚¹ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì½˜í…ì¸  íƒìƒ‰ ë° ê²€ìƒ‰
  - AI, Backend, Frontend ë“± ê¸°ìˆ  ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê²Œì‹œê¸€ì„ í•„í„°ë§í•˜ì—¬ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì‹¤ì‹œê°„ ê²€ìƒ‰ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ê³ , ê´€ë ¨ë„ìˆœ/ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ìƒì„¸ ê²€ìƒ‰ì„ ì§€ì›í•©ë‹ˆë‹¤.

- AI ê¸°ë°˜ ê°œì¸í™” ì¶”ì²œ
  - ì‚¬ìš©ìì˜ ì½˜í…ì¸  ì¡°íšŒ ì´ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AIê°€ í¥ë¯¸ë¡œì›Œí•  ë§Œí•œ ì•„í‹°í´ì„ ê°œì¸í™”í•˜ì—¬ ì¶”ì²œí•©ë‹ˆë‹¤.
  - ê²Œì‹œê¸€ì˜ ì˜ë¯¸ë¥¼ ë¶„ì„í•œ ë²¡í„° ê²€ìƒ‰ì„ í†µí•´ ê´€ë ¨ì„± ë†’ì€ ì½˜í…ì¸ ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

- ì¸ì‚¬ì´íŠ¸ ë° í†µê³„
  - ì¸ê¸°ê¸€, AI ì¶”ì²œê¸€ ë“± ë‹¤ì–‘í•œ ê¸°ì¤€ìœ¼ë¡œ ì§‘ê³„ëœ í†µê³„ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
  - ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ìˆ˜, ê¸°ì—…ë³„ í¬ìŠ¤íŒ… í˜„í™© ë“±ì„ ì°¨íŠ¸ë¡œ ì‹œê°í™”í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.

- ìƒì„¸ ë³´ê¸° ë° ì¡°íšŒìˆ˜
  - ê° ì•„í‹°í´ì˜ AI ìš”ì•½, íƒœê·¸, ì›ë¬¸ ë§í¬ ë“± ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì‚¬ìš©ìì˜ IPë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°íšŒìˆ˜ë¥¼ ì§‘ê³„í•˜ì—¬ ê²Œì‹œê¸€ì˜ ì¸ê¸°ë„ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "í´ë¼ì´ì–¸íŠ¸"
        Client[Web Browser]
    end

    subgraph "ì¸í”„ë¼ ë ˆì´ì–´"
        Nginx[Nginx<br/>ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ & SSL]
    end

    subgraph "ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´"
        subgraph "API ëª¨ë“ˆ"
            Controller[Controllers<br/>post, search, recommend<br/>company, category]
            AID[AID Manager<br/>ìµëª… ì‚¬ìš©ì ì¶”ì ]
        end

        subgraph "Domain ëª¨ë“ˆ"
            Service[Domain Services<br/>PostService, SearchService<br/>RecommendationService]
            Repository[Repositories<br/>JPA + Querydsl]
            Embedding[Embedding Service<br/>ë²¡í„° ì„ë² ë”©]
            Summarizer[Article Summarizer<br/>AI ìš”ì•½]
        end

        subgraph "Batch ëª¨ë“ˆ"
            FeedParser[RSS Feed Parser<br/>Atom/RSS]
            Crawler[Web Crawler<br/>ì»¨í…ì¸  ì¶”ì¶œ]
            BatchProcessor[Batch Processor<br/>ìš”ì•½ & ì„ë² ë”©]
        end
    end

    subgraph "ë°ì´í„° ë ˆì´ì–´"
        PostgreSQL[(PostgreSQL<br/>ê´€ê³„í˜• ë°ì´í„°<br/>ë²¡í„° ê²€ìƒ‰)]
    end

    subgraph "ì™¸ë¶€ API"
        Gemini[Google Gemini API<br/>ìš”ì•½ & ì„ë² ë”©]
        RSS[ê¸°ì—… ê¸°ìˆ ë¸”ë¡œê·¸<br/>RSS Feeds]
    end

    Client -->|HTTPS| Nginx
    Nginx -->|Proxy| Controller
    Controller --> AID
    Controller --> Service
    Service --> Repository
    Service --> Embedding
    Service --> Summarizer
    Repository --> PostgreSQL

    FeedParser -->|ìŠ¤ì¼€ì¤„ë§| RSS
    RSS -->|XML/Atom| FeedParser
    FeedParser --> Crawler
    Crawler --> BatchProcessor
    BatchProcessor --> Summarizer
    BatchProcessor --> Embedding
    BatchProcessor --> Repository

    Embedding -->|API í˜¸ì¶œ| Gemini
    Summarizer -->|API í˜¸ì¶œ| Gemini

    style Client fill:#e1f5ff
    style Nginx fill:#ffe1e1
    style PostgreSQL fill:#e1ffe1
    style Gemini fill:#fff4e1
    style RSS fill:#f0e1ff
```

## ğŸ›  Tech Stack

### Language

![Kotlin](https://img.shields.io/badge/Kotlin-7F52FF?style=for-the-badge&logo=kotlin&logoColor=white)

### Framework & Runtime

![Spring Boot](https://img.shields.io/badge/Spring%20Boot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white)
![Spring Batch](https://img.shields.io/badge/Spring%20Batch-6DB33F?style=for-the-badge&logo=spring&logoColor=white)
![JPA](https://img.shields.io/badge/JPA-59666C?style=for-the-badge&logo=hibernate&logoColor=white)
![Querydsl](https://img.shields.io/badge/Querydsl-4695EB?style=for-the-badge&logo=java&logoColor=white)

### Database

![PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?style=for-the-badge&logo=postgresql&logoColor=white)
![pgvector](https://img.shields.io/badge/pgvector-4169E1?style=for-the-badge&logo=postgresql&logoColor=white)

### AI / ML

![Google Gemini](https://img.shields.io/badge/Google%20Gemini-8E75B2?style=for-the-badge&logo=googlegemini&logoColor=white)

### Infra & DevOps

![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![Nginx](https://img.shields.io/badge/Nginx-009639?style=for-the-badge&logo=nginx&logoColor=white)
![GitHub Actions](https://img.shields.io/badge/GitHub%20Actions-2088FF?style=for-the-badge&logo=githubactions&logoColor=white)
![AWS](https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazonwebservices&logoColor=white)

### Runtime

![JDK 21](https://img.shields.io/badge/JDK-21-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white)
![Gradle](https://img.shields.io/badge/Gradle-02303A?style=for-the-badge&logo=gradle&logoColor=white)

## ì ‘ì† ë§í¬

https://www.techinsights.shop/

## ğŸ“¡ API Endpoints

### Post API

| Method | Endpoint                      | Description                  |
|--------|-------------------------------|------------------------------|
| `GET`  | `/api/v1/posts`               | ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•, ì •ë ¬, ì¹´í…Œê³ ë¦¬ í•„í„°) |
| `GET`  | `/api/v1/posts/{postId}`      | ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ                    |
| `POST` | `/api/v1/posts/{postId}/view` | ì¡°íšŒìˆ˜ ê¸°ë¡                       |

### Search API

| Method | Endpoint                 | Description            |
|--------|--------------------------|------------------------|
| `GET`  | `/api/v1/search/instant` | ì‹¤ì‹œê°„ ê²€ìƒ‰ (ìë™ì™„ì„±)          |
| `GET`  | `/api/v1/search`         | ìƒì„¸ ê²€ìƒ‰ (í˜ì´ì§•, ì •ë ¬, íšŒì‚¬ í•„í„°) |

### Company API

| Method | Endpoint                         | Description    |
|--------|----------------------------------|----------------|
| `GET`  | `/api/v1/companies`              | íšŒì‚¬ ëª©ë¡ ì¡°íšŒ       |
| `GET`  | `/api/v1/companies/{companyId}`  | íšŒì‚¬ ìƒì„¸ ì¡°íšŒ       |
| `GET`  | `/api/v1/companies/top-by-views` | ì¡°íšŒìˆ˜ ê¸°ì¤€ ìƒìœ„ íšŒì‚¬   |
| `GET`  | `/api/v1/companies/top-by-posts` | ê²Œì‹œê¸€ ìˆ˜ ê¸°ì¤€ ìƒìœ„ íšŒì‚¬ |
| `GET`  | `/api/v1/companiesSummaries`     | íšŒì‚¬ë³„ ê²Œì‹œê¸€ í†µê³„     |

### Category API

| Method | Endpoint                     | Description  |
|--------|------------------------------|--------------|
| `GET`  | `/api/v1/categories/summary` | ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ í†µê³„ |

### Recommendation API

| Method | Endpoint                  | Description   |
|--------|---------------------------|---------------|
| `GET`  | `/api/v1/recommendations` | AI ê¸°ë°˜ ê°œì¸í™” ì¶”ì²œ  |

## Preview

| ê²€ìƒ‰ ê¸°ëŠ¥                                                            | ì„¸ë¶€ í˜ì´ì§€                                                                | ë‹¤í¬ëª¨ë“œ                                                              |
|------------------------------------------------------------------|-----------------------------------------------------------------------|-------------------------------------------------------------------|
| <img src="./img/gif/Search_Test.gif" alt="ê²€ìƒ‰ ê¸°ëŠ¥ ë°ëª¨" width="300"> | <img src="./img/gif/DetailView_Test.gif" alt="ì„¸ë¶€ í˜ì´ì§€ ë°ëª¨" width="300"> | <img src="./img/gif/DarkMode_Test.gif" alt="ë‹¤í¬ëª¨ë“œ ë°ëª¨" width="300"> |

### ë°ì´í„°ë² ì´ìŠ¤ ERD

## ERD
```mermaid
erDiagram
    Company {
        Long id PK
        String name "íšŒì‚¬ëª…"
        String blogUrl "ë¸”ë¡œê·¸ ì£¼ì†Œ"
        String logoImageName "ë¡œê³  ì´ë¯¸ì§€"
        Boolean rssSupported "RSS ì§€ì› ì—¬ë¶€"
        Long totalViewCount "ì´ ì¡°íšŒìˆ˜"
        Long postCount "ê²Œì‹œë¬¼ ìˆ˜"
    }

    Post {
        Long id PK
        String title "ì œëª©"
        String preview "ë¯¸ë¦¬ë³´ê¸°"
        String url "ì›ë³¸ ë§í¬"
        String content "ë‚´ìš©"
        LocalDateTime publishedAt "ê²Œì‹œì¼"
        String thumbnail "ì¸ë„¤ì¼"
        Long company_id FK "íšŒì‚¬ ID"
        Long viewCount "ì¡°íšŒìˆ˜"
        Boolean isSummary "ìš”ì•½ ì—¬ë¶€"
        Boolean isEmbedding "ì„ë² ë”© ì—¬ë¶€"
    }

    post_categories {
        Long post_id FK "ê²Œì‹œë¬¼ ID"
        String category "ì¹´í…Œê³ ë¦¬"
    }

    PostEmbedding {
        Long postId PK "ê²Œì‹œë¬¼ ID (FK)"
        String companyName "íšŒì‚¬ëª…"
        String categories "ì¹´í…Œê³ ë¦¬"
        String content "ë‚´ìš©"
        FloatArray embeddingVector "ì„ë² ë”© ë²¡í„°"
    }

    PostView {
        Long id PK
        Long postId FK "ê²Œì‹œë¬¼ ID"
        String userOrIp "ì‚¬ìš©ì ë˜ëŠ” IP"
        LocalDate viewedDate "ì¡°íšŒì¼"
    }

    AnonymousUserReadHistory {
        Long id PK
        String anonymousId "ìµëª… ì‚¬ìš©ì ID"
        Long postId FK "ê²Œì‹œë¬¼ ID"
        LocalDateTime readAt "ì½ì€ ì‹œê°„"
    }

    Company ||--o{ Post : "owns"
    Post }|..|| PostEmbedding : "has one"
    Post ||--o{ PostView : "has many"
    Post ||--o{ AnonymousUserReadHistory : "has many"
    Post ||--o{ post_categories : "has many"
```

## Technical Challenges & Solutions

### 1. ì¡°íšŒìˆ˜ ì§‘ê³„ íŠ¸ëœì­ì…˜ ìµœì í™”

**ë¬¸ì œ ìƒí™©**

ê¸°ì¡´ `recordView()` ë©”ì„œë“œì—ì„œ ì¤‘ë³µ ì²´í¬, PostView ì €ì¥, Post ì¡°íšŒìˆ˜ ì¦ê°€, Company ì´ ì¡°íšŒìˆ˜ ì¦ê°€ê°€ ë‹¨ì¼ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ ìˆì—ˆìŠµë‹ˆë‹¤. íŠ¸ëœì­ì…˜
ë²”ìœ„ê°€ ê³¼ë„í•˜ê²Œ ë„“ì–´ì§€ë©´ì„œ DB Lock ê²½í•©ì´ ë°œìƒí•˜ê³ , ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ ì „ì²´ ì¡°íšŒ ê¸°ë¡ì´ ë¡¤ë°±ë˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

**í•´ê²° ë°©ì•ˆ**

Spring Eventì™€ `@TransactionalEventListener`ë¥¼ í™œìš©í•˜ì—¬ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.
(Redisë¥¼ í˜„ì¬ ì‚¬ìš©í•˜ì§€ ëª» í•˜ê¸° ë•Œë¬¸ì— ì„ì‹œë¡œ DB ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ êµ¬í˜„)

1. ì¡°íšŒ ê¸°ë¡ ì €ì¥: ì¤‘ë³µ ì²´í¬ ë° PostView ì €ì¥ì€ ê¸°ì¡´ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì²˜ë¦¬
2. ì¡°íšŒìˆ˜ ì¦ê°€: Post ë° Company ì¡°íšŒìˆ˜ ì¦ê°€ëŠ” ë³„ë„ì˜ ë¹„ë™ê¸° ì´ë²¤íŠ¸
3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ í›„ ì‹¤í–‰: ì¡°íšŒ ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ëœ í›„ì—ë§Œ ì¡°íšŒìˆ˜ ì¦ê°€ ë¡œì§ ì‹¤í–‰
4. ì¥ì•  ê²©ë¦¬: ì¡°íšŒìˆ˜ ì¦ê°€ ì‹¤íŒ¨ ì‹œì—ë„ ì¡°íšŒ ê¸°ë¡ì€ ìœ ì§€
5. ë¹„ë™ê¸° ì²˜ë¦¬: ì‚¬ìš©ì ì‘ë‹µ ì§€ì—° ë°©ì§€
6. Eventual Consistency: ì¡°íšŒìˆ˜ëŠ” ìµœì¢…ì ìœ¼ë¡œ ì¼ê´€ì„±ì„ ë³´ì¥
7. ì„±ëŠ¥ í–¥ìƒ: íŠ¸ëœì­ì…˜ ê²½í•© ê°ì†Œë¡œ ì „ì²´ ì²˜ë¦¬ëŸ‰ ì¦ê°€

```kotlin
@Async
@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
fun handleViewCountIncrement(event: ViewCountIncrementEvent) {
  viewCountUpdater.incrementViewCount(event.postId)
  companyViewCountUpdater.incrementTotalViewCount(event.companyId)
}
```

- **AFTER_COMMIT**: ì¡°íšŒ ê¸°ë¡ íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ëœ í›„ì—ë§Œ ì¹´ìš´íŠ¸ ì¦ê°€ ë¡œì§ ì‹¤í–‰
- **@Async**: ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì‚¬ìš©ì ì‘ë‹µ ì§€ì—° ë°©ì§€
- **Eventual Consistency**: ì¹´ìš´íŠ¸ ì‹¤íŒ¨ê°€ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ

---

### 2. ë²¡í„° ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”

**ì•„í‚¤í…ì²˜ ì„¤ê³„**

PostgreSQLì˜ pgvector í™•ì¥ì„ í™œìš©í•˜ì—¬ 3072ì°¨ì› ì„ë² ë”© ë²¡í„° ê¸°ë°˜ì˜ ìœ ì‚¬ë„ ê²€ìƒ‰ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```kotlin
@JdbcTypeCode(SqlTypes.VECTOR)
@Array(length = 3072)
@Column(name = "embedding_vector")
val embeddingVector: FloatArray
```

**ê²€ìƒ‰ ë¡œì§**

ì‚¬ìš©ìì˜ ìµœê·¼ ì½ìŒ ì´ë ¥(10ê°œ)ì˜ ì„ë² ë”© ë²¡í„°ë¥¼ í‰ê· í™”í•˜ì—¬ ê°œì¸í™”ëœ ì¶”ì²œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```sql
SELECT * FROM post_embedding
WHERE post_id NOT IN :excludeIds
ORDER BY embedding_vector <-> CAST(:targetVector AS vector)
LIMIT :limit
```

- **L2 Distance (`<->`)**: ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê¸°ë°˜ ìœ ì‚¬ë„ ì¸¡ì •
- **í‰ê·  ë²¡í„° ê¸°ë²•**: ë‹¤ìˆ˜ì˜ ê´€ì‹¬ì‚¬ë¥¼ ë‹¨ì¼ ë²¡í„°ë¡œ ì‘ì¶•í•˜ì—¬ ì¿¼ë¦¬ ë³µì¡ë„ ê°ì†Œ
- **ì œì™¸ í•„í„°**: ì´ë¯¸ ì½ì€ ê²Œì‹œê¸€ì„ ê²°ê³¼ì—ì„œ ë°°ì œí•˜ì—¬ ì¶”ì²œ í’ˆì§ˆ í–¥ìƒ

---

### 3. RSS/Atom í”¼ë“œ íŒŒì‹± ë° ì¤‘ë³µ ì²˜ë¦¬

**Strategy Pattern ê¸°ë°˜ íŒŒì„œ ì„¤ê³„**

ë‹¤ì–‘í•œ í”¼ë“œ í˜•ì‹(RSS 2.0, Atom 1.0)ê³¼ ê¸°ì—…ë³„ ì»¤ìŠ¤í…€ êµ¬ì¡°ë¥¼ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì „ëµ íŒ¨í„´ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

```
FeedTypeStrategyResolver
â”œâ”€â”€ RssFeedStrategy      (RSS 2.0)
â””â”€â”€ AtomFeedStrategy     (Atom 1.0)

BlogParserResolver
â”œâ”€â”€ FeedParser           (ì¼ë°˜ RSS/Atom)
â”œâ”€â”€ OliveYoungBlogParser (íŠ¹ìˆ˜ ì²˜ë¦¬)
â””â”€â”€ ElevenStBlogParser   (íŠ¹ìˆ˜ ì²˜ë¦¬)
```

**ì¤‘ë³µ ê°ì§€ ì „ëµ**

URL ê¸°ë°˜ì˜ Idempotent ì²˜ë¦¬ë¡œ í¬ë¡¤ë§ ì‹œ ì¤‘ë³µ ê²Œì‹œê¸€ì„ ë°©ì§€í•©ë‹ˆë‹¤.

```kotlin
val existUrls = postRepository.findAllByUrlIn(originalUrls).map { it.url }.toSet()
val filteredPosts = allPosts.filter { it.url !in existUrls }
```

**ë„ë©”ì¸ë³„ ì»¨í…ì¸  ì¶”ì¶œ**

13ê°œ ê¸°ì—… ê¸°ìˆ ë¸”ë¡œê·¸ì˜ HTML êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ ë„ë©”ì¸ë³„ CSS ì„ íƒìë¥¼ ë§¤í•‘í–ˆìŠµë‹ˆë‹¤.

```kotlin
val selectorMapping = mapOf(
  "techblog.woowahan.com" to ".post-content-inner > .post-content-body",
  "tech.kakao.com" to ".inner_content > .daum-wm-content.preview",
  "toss.tech" to "article.css-hvd0pt > div.css-1vn47db",
  // ... 10ê°œ ì¶”ê°€ ë„ë©”ì¸
)
```

---

### 4. Gemini API Rate Limit ê´€ë¦¬

**Resilience4j ê¸°ë°˜ Rate Limiting**

ì™¸ë¶€ API í˜¸ì¶œì˜ ì•ˆì •ì„±ì„ ìœ„í•´ Resilience4j RateLimiterë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.

```kotlin
@Bean
fun rateLimiterRegistry(): RateLimiterRegistry {
  val geminiConfig = RateLimiterConfig.custom()
    .limitForPeriod(8)                    // 60ì´ˆë‹¹ 8íšŒ
    .limitRefreshPeriod(Duration.ofSeconds(60))
    .timeoutDuration(Duration.ofSeconds(30))
    .build()

  return RateLimiterRegistry.of(geminiConfig)
}
```

**í˜¸ì¶œ ì „ëµ**

```kotlin
val response = rateLimiter.executeCallable {
  geminiClient.models.generateContent(modelName, prompt, config)
}
```

- **ì²­í¬ ë‹¨ìœ„ ë°°ì¹˜ ì²˜ë¦¬**: ìš”ì•½(10ê°œ), ì„ë² ë”©(1ê°œ) ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ì—¬ API í˜¸ì¶œ ìµœì í™”
- **Fault Tolerance**: ìµœëŒ€ 3íšŒ ì¬ì‹œë„, 10ê°œ ìŠ¤í‚µ í—ˆìš©ìœ¼ë¡œ ë¶€ë¶„ ì‹¤íŒ¨ ê²©ë¦¬
- **ë„ë©”ì¸ë³„ ì°¨ë“± ì œí•œ**: í¬ë¡¤ë§ ëŒ€ìƒ ë„ë©”ì¸ë³„ë¡œ ë³´ìˆ˜ì /ê¸°ë³¸ Rate Limit êµ¬ë¶„ ì ìš©

---

### 5. N+1 ì¿¼ë¦¬ ìµœì í™”

**Querydsl fetchJoin ì „ëµ**

Post-Company ê´€ê³„ì—ì„œ ë°œìƒí•˜ëŠ” N+1 ë¬¸ì œë¥¼ Querydslì˜ fetchJoinìœ¼ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

```kotlin
val posts = queryFactory.selectFrom(postEntity)
  .leftJoin(postEntity.company, companyEntity).fetchJoin()
  .where(postEntity.url.`in`(urls))
  .fetch()
```

- Post ì¡°íšŒ ë©”ì„œë“œ 12ê°œ ëª¨ë‘ì— Company fetchJoin ì ìš©
- ê²€ìƒ‰ ì¿¼ë¦¬ì—ë„ ë™ì¼í•œ íŒ¨í„´ ì ìš©

**BatchSizeë¥¼ í†µí•œ ElementCollection ìµœì í™”**

```kotlin
@BatchSize(size = 100)
@ElementCollection(fetch = FetchType.LAZY, targetClass = Category::class)
var categories: MutableSet<Category> = mutableSetOf()
```

- categories ë¡œë”© ì‹œ N+1ì„ `1 + ceil(N/100)` ì¿¼ë¦¬ë¡œ ì™„í™”
- 1000ê°œ Post ì¡°íšŒ ì‹œ 1000íšŒ â†’ 11íšŒë¡œ ì¿¼ë¦¬ ê°ì†Œ

**DTO Projection í™œìš©**

ì§‘ê³„ ì¿¼ë¦¬ì—ì„œ ë¶ˆí•„ìš”í•œ ì—”í‹°í‹° ë¡œë”©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ Querydsl Projectionì„ í™œìš©í–ˆìŠµë‹ˆë‹¤.

```kotlin
.select(
  Projections.constructor(
    CompanyPostSummaryDto::class.java,
    company.id, company.name, company.blogUrl,
    company.logoImageName, company.totalViewCount,
    post.id.count(), post.publishedAt.max()
  )
)
```

---

### Initial Design

Home

![Image](https://github.com/user-attachments/assets/d5533bfa-e6cb-46af-9c32-16a3d9b98aa0)

