batch:
  post-crawling:
    job-name: crawlPostJob
    step-name: crawlPostStep
    chunk-size: 1
    retry-limit: 3
    core-pool-size: 6
    max-pool-size: 6
  processing:
    # Gemini API 5 RPM
    concurrency-limit: 1
    timeout-ms: 180000
  jitter:
    enabled: true
    min-ms: 100
    max-ms: 2000

web-client:
  connect-timeout-millis: 10000
  response-timeout-seconds: 15
  read-timeout-seconds: 15
  write-timeout-seconds: 15
  max-in-memory-size-mb: 5
  user-agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  retry:
    max-attempts: 3
    backoff-seconds: 2

spring:
  datasource:
    hikari:
      maximum-pool-size: 8
      minimum-idle: 3
      connection-timeout: 20000

content:
  selectors:
    techblog.woowahan.com:
      - ".post-content-inner > .post-content-body"

    tech.kakao.com:
      - ".inner_content > .daum-wm-content.preview"

    toss.tech:
      - "article.css-hvd0pt > div.css-1vn47db"

    d2.naver.com:
      - "article"
      - ".post-area"
      - ".section-content"
      - ".post-body"
      - ".content-area"

    helloworld.kurly.com:
      - ".post-content"
      - ".article-body"
      - ".post"

    medium.com:
      - "article"
      - ".meteredContent"
      - ".pw-post-body"
      - ".postArticle-content"

  default-selectors:
    - "article"
    - ".post-content"
    - ".entry-content"
    - "#content"
    - ".blog-post"


rate-limiter:
  gemini:
    limit-for-period: 8
    refresh-period-seconds: 60
    timeout-seconds: 30
  gemini-batch-rpm:
    limit-for-period: 5
    refresh-period-seconds: 60
    timeout-seconds: 60
  gemini-batch-rpd:
    limit-for-period: 20
    refresh-period-seconds: 86400
    timeout-seconds: 1
  crawler:
    ultra-safe:
      limit-for-period: 5
      refresh-period-seconds: 60
      timeout-seconds: 30
    conservative:
      limit-for-period: 10
      refresh-period-seconds: 60
      timeout-seconds: 30
    standard:
      limit-for-period: 15
      refresh-period-seconds: 60
      timeout-seconds: 30

circuit-breaker:
  gemini-batch:
    failure-rate-threshold: 50  # 실패율 50% 이상 시 오픈
    slow-call-rate-threshold: 80  # 느린 호출 80% 이상 시 오픈
    slow-call-duration-threshold-seconds: 180  # 30초 이상 걸리면 느린 호출로 간주
    wait-duration-in-open-state-seconds: 60  # OPEN 상태 60초 유지
    permitted-number-of-calls-in-half-open-state: 3  # HALF_OPEN 시 3개 호출 허용
    sliding-window-size: 10  # 최근 10개 호출 기준
    minimum-number-of-calls: 5  # 최소 5개 호출 후 통계 계산

gemini:
  api-key: ${GEMINI_API_KEY}
  max-output-tokens: 16384